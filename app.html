<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini App — Watch Collection Randomizer</title>
  <meta name="description" content="Single-file watch collection randomizer built with AI collaboration." />

  <!-- Bootstrap + Bootswatch Lux (same as other pages) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lux/bootstrap.min.css" rel="stylesheet">

  <!-- Shared site styles (navbar, background, etc.) -->
  <link rel="stylesheet" href="styles.css" />

  <!-- App-specific styles (keeps the card look, but respects shared background) -->
  <style>
    :root {
      --bg: #e5e7eb;         /* same light gray as other pages */
      --panel: #ffffff;      /* white card */
      --accent: #5bc0be;     /* button accent */
      --text: #111827;       /* dark text */
      --muted: #6b7280;      /* muted gray text */
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background-color: var(--bg);
      color: var(--text);
    }

    .app-shell {
      max-width: 900px;
      margin: 0 auto 3rem;
      padding: 2rem 1rem 0;
    }

    .app-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .app-header h1 {
      margin: 0 0 .5rem;
      font-size: clamp(1.6rem, 2.4vw + 1rem, 2.5rem);
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .app-header p {
      margin: 0;
      color: var(--muted);
    }

    .app { margin-top: 1.5rem; }

    .panel {
      background: var(--panel);
      border-radius: 14px;
      padding: 1.5rem;
      box-shadow: 0 6px 22px rgba(0,0,0,.08);
      border: 1px solid #e5e7eb;
    }

    .controls {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      margin-bottom: 1rem;
    }

    label {
      font-size: .9rem;
      color: var(--muted);
      display: block;
      margin-bottom: .25rem;
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    input[type="text"], select {
      width: 100%;
      padding: .65rem .8rem;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #f3f4f6;
      color: var(--text);
    }

    button {
      cursor: pointer;
      border-radius: 10px;
      padding: .75rem 1rem;
      font-weight: 600;
      transition: transform .05s ease, box-shadow .05s ease, background-color .15s ease;
      border: 0;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .btn-primary {
      background: var(--accent);
      color: #032030;
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
    }

    .btn-ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid #d1d5db;
    }

    .stack {
      display: flex;
      gap: .75rem;
      flex-wrap: wrap;
    }

    .output {
      margin-top: 1rem;
      white-space: pre-wrap;
      font-size: 1.05rem;
    }

    .hint {
      font-size: .95rem;
      color: #374151;
      margin-top: .5rem;
    }

    .footer-note {
      text-align: center;
      opacity: .9;
      margin: 2rem 0 0;
      color: var(--muted);
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      background:#f3f4f6;
      border:1px solid #d1d5db;
      padding:.1rem .35rem;
      border-radius:6px;
    }

    .back-link {
      margin-top: 0.75rem;
      text-align: center;
    }

    .back-link a {
      color: var(--muted);
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <!-- Shared Bootstrap navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">CW</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
        aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="resume.html">Résumé</a></li>
          <li class="nav-item"><a class="nav-link" href="scratch.html">Scratch</a></li>
          <li class="nav-item"><a class="nav-link active" href="app.html">Mini App</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- App content -->
  <main class="app-shell">
    <header class="app-header">
      <h1>Watch Collection Randomizer</h1>
      <p>Pick an occasion and mood, then let the app choose a watch from your virtual collection.</p>
      <div class="back-link">
        <a href="scratch.html">← Back to Watch Collecting Page</a>
      </div>
    </header>

    <section class="app">
      <section class="panel" aria-labelledby="controls-title">
        <h2 id="controls-title" class="visually-hidden" style="position:absolute;left:-9999px;">
          Watch Collection Controls
        </h2>

        <div class="controls">
          <div>
            <label for="occasion">Occasion</label>
            <select id="occasion" aria-label="Occasion">
              <option value="any">Any occasion</option>
              <option value="work">Work / School</option>
              <option value="casual">Casual / Weekend</option>
              <option value="dress">Dress / Formal</option>
              <option value="adventure">Adventure / Travel</option>
              <option value="water">Water / Swimming</option>
              <option value="date">Date Night</option>
            </select>
          </div>

          <div>
            <label for="mood">Mood</label>
            <select id="mood" aria-label="Mood">
              <option value="any">Any mood</option>
              <option value="classic">Classic</option>
              <option value="bold">Bold</option>
              <option value="minimal">Minimal</option>
              <option value="sporty">Sporty</option>
              <option value="vintage">Vintage</option>
            </select>
          </div>

          <div>
            <label for="keyword">Optional keyword</label>
            <input id="keyword" type="text"
                   placeholder="e.g., GMT, blue dial, gold"
                   aria-label="Keyword filter">
          </div>
        </div>

        <div class="stack" role="group" aria-label="Actions">
          <button class="btn-primary" id="gen">Pick My Watch</button>
          <button class="btn-ghost" id="toggle" aria-expanded="false">Show / Hide Details</button>
          <button class="btn-ghost" id="share">Copy Share Link</button>
        </div>

        <div class="output" id="watchMain" aria-live="polite"></div>
        <div class="hint" id="watchDetails" style="display:none;"></div>
      </section>

      <div class="footer-note">
        Pro tip: Press <span class="kbd">G</span> to pick a watch.
      </div>
    </section>
  </main>

  <!-- Shared footer (same as other pages) -->
  <footer class="py-4 bg-dark text-white-50">
    <div class="container text-center">
      <small>© <span id="year"></span> Clayton Walburger</small>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- Watch collection randomizer logic -->
  <script>
    // Simple local "collection" – edit or expand whenever you want
    const WATCHES = [
      {
        id: "bb58",
        name: "Black Bay 58",
        brand: "Tudor",
        style: "Diver",
        occasion: ["casual", "work", "adventure", "water"],
        mood: ["classic", "sporty"],
        notes: "39mm diver with great proportions. Works on bracelet, leather, or rubber.",
      },
      {
        id: "snowflake",
        name: "Snowflake",
        brand: "Grand Seiko",
        style: "Dress / Everyday",
        occasion: ["work", "dress", "casual"],
        mood: ["classic", "minimal"],
        notes: "Highly finished dial that still flies under the radar. Ideal for office and formal wear.",
      },
      {
        id: "speedy",
        name: "Speedmaster Professional",
        brand: "Omega",
        style: "Chronograph",
        occasion: ["work", "casual", "date"],
        mood: ["classic", "sporty"],
        notes: "Moonwatch vibes with a chronograph complication. Great conversation starter.",
      },
      {
        id: "explorer",
        name: "Explorer",
        brand: "Rolex",
        style: "Field / Explorer",
        occasion: ["work", "casual", "adventure"],
        mood: ["minimal", "classic"],
        notes: "Clean 3-hand layout, super versatile, and ready for just about anything.",
      },
      {
        id: "tank",
        name: "Tank",
        brand: "Cartier",
        style: "Dress",
        occasion: ["dress", "date"],
        mood: ["classic", "vintage"],
        notes: "Rectangular case, Roman numerals, and pure dress-watch energy.",
      },
      {
        id: "skx",
        name: "SKX007",
        brand: "Seiko",
        style: "Diver",
        occasion: ["casual", "adventure", "water"],
        mood: ["sporty", "bold"],
        notes: "Affordable legend. ISO-rated diver that can take a beating and keep ticking.",
      },
      {
        id: "gshock",
        name: "DW-5600",
        brand: "G-Shock",
        style: "Digital / Beater",
        occasion: ["adventure", "water", "casual"],
        mood: ["bold", "sporty"],
        notes: "Lightweight, tough, and worry-free. Perfect for the gym, hikes, or pool days.",
      },
      {
        id: "reverso",
        name: "Reverso",
        brand: "Jaeger-LeCoultre",
        style: "Dress / Art Deco",
        occasion: ["dress", "date"],
        mood: ["vintage", "classic"],
        notes: "Art Deco icon with a reversible case. Great for slightly dressier occasions.",
      }
    ];

    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function findWatchById(id) {
      return WATCHES.find(w => w.id === id) || null;
    }

    function chooseWatch(occasion, mood, keyword) {
      let pool = WATCHES.slice();

      if (occasion && occasion !== "any") {
        pool = pool.filter(w => w.occasion.includes(occasion));
      }

      if (mood && mood !== "any") {
        pool = pool.filter(w => w.mood.includes(mood));
      }

      const kw = keyword.trim().toLowerCase();
      if (kw) {
        pool = pool.filter(w => {
          const haystack = [
            w.name,
            w.brand,
            w.style,
            (w.notes || ""),
          ].join(" ").toLowerCase();
          return haystack.includes(kw);
        });
      }

      if (!pool.length) {
        pool = WATCHES.slice(); // fallback to full collection
      }

      return pickRandom(pool);
    }

    // DOM elements
    const occasionEl   = document.getElementById("occasion");
    const moodEl       = document.getElementById("mood");
    const keywordEl    = document.getElementById("keyword");
    const mainOut      = document.getElementById("watchMain");
    const detailsOut   = document.getElementById("watchDetails");
    const toggleButton = document.getElementById("toggle");

    function renderWatch(watch) {
      mainOut.textContent =
        `${watch.brand} “${watch.name}” — ${watch.style}`;

      const occasionText = watch.occasion
        .map(o => o.charAt(0).toUpperCase() + o.slice(1))
        .join(", ");

      const moodText = watch.mood
        .map(m => m.charAt(0).toUpperCase() + m.slice(1))
        .join(", ");

      detailsOut.innerHTML =
        `<strong>Occasions:</strong> ${occasionText}<br>` +
        `<strong>Mood:</strong> ${moodText}<br>` +
        `<strong>Notes:</strong> ${watch.notes}`;

      detailsOut.style.display = "none";
      toggleButton.setAttribute("aria-expanded", "false");
    }

    function updateUrlParams(watch) {
      const url = new URL(window.location);
      url.searchParams.set("o", occasionEl.value);
      url.searchParams.set("m", moodEl.value);
      url.searchParams.set("k", keywordEl.value || "");
      url.searchParams.set("w", watch.id);
      history.replaceState(null, "", url);
    }

    function generateWatch() {
      const chosen = chooseWatch(
        occasionEl.value,
        moodEl.value,
        keywordEl.value || ""
      );
      renderWatch(chosen);
      updateUrlParams(chosen);
    }

    // Button events
    document.getElementById("gen").addEventListener("click", generateWatch);

    toggleButton.addEventListener("click", () => {
      const currentlyHidden = detailsOut.style.display === "none";
      detailsOut.style.display = currentlyHidden ? "block" : "none";
      toggleButton.setAttribute("aria-expanded", String(currentlyHidden));
    });

    document.getElementById("share").addEventListener("click", () => {
      const link = window.location.href;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(link).then(() => {
          alert("Link copied to clipboard!");
        }, () => {
          prompt("Copy this link:", link);
        });
      } else {
        prompt("Copy this link:", link);
      }
    });

    // Keyboard shortcut: G to generate
    window.addEventListener("keydown", e => {
      if (e.key.toLowerCase() === "g") generateWatch();
    });

    // Load state from URL if present
    (function initFromUrl() {
      const params = new URLSearchParams(location.search);
      if (params.has("o")) occasionEl.value = params.get("o");
      if (params.has("m")) moodEl.value = params.get("m");
      if (params.has("k")) keywordEl.value = params.get("k");

      let fromUrl = null;
      if (params.has("w")) {
        fromUrl = findWatchById(params.get("w"));
      }

      if (fromUrl) {
        renderWatch(fromUrl);
      } else {
        generateWatch();
      }
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
